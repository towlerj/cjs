<!doctype html>
<html lang=en>
<head>
<meta charset=utf-8>
<title>Da-Da-Dum</title>
<style type="text/css"> 
	body {
		background-color: #000000;
		margin: 0px;
		text-align:center;
	}
	canvas {
		background-color:#111133;
	}

</style>


</head>
<body>
	
<script src="js/Vector2_jt.js"></script>
	
<script>

// canvas element and 2D context
var canvas = document.createElement( 'canvas' ),
	context = canvas.getContext( '2d' );

var gen = 1;
var pRem = 100; // steps to start removing
var pAdd = 100; // steps to start adding
var jDist = 500; // max distance we'll join
var jMDist = 25; // min distance we'll join
var fRate = 600; // frame rate
var lAl = .003; // line transparency
var lAl2 = .1; // line2 transparency
var cCa = 50000; // The rest timer
var MAX_PARTICLES=1000; // max [articles]

canvas.width = window.innerWidth; 
canvas.height = window.innerHeight; 
document.body.appendChild(canvas);

c = context; 

var particles = []; 

for(var i=0;i<MAX_PARTICLES; i++) {
	
	var particle = new Particle();
	particle.pos.reset(Math.random()*canvas.width, Math.random()*canvas.height);  
	particle.vel.reset(randomRange(-3,3), randomRange(-3,3)); 
	particles.push(particle);
}

setInterval(loop, 1000/fRate); 

function loop() { 
	
	gen++;
	
	// #####################
	if (gen%cCa == 0){
		c.clearRect(0,0,canvas.width, canvas.height);
	}
	
//	c.clearRect(0,0,canvas.width, canvas.height); 
//	c.fillStyle = "rgba(0,0,0,0.01)"; 
	
	
	// #####################
	
	for(var i=0; i<particles.length; i++) {
		
		var p = particles[i]; 
		p.update(canvas); 
		p.draw(c); 
		
	}

	// #####################
	// remove and add
	if (gen%pRem==0){
		for (var i = particles.length;i>MAX_PARTICLES;i--){
			particles.shift();
		}
	}
	
	
	if(gen%pAdd==0){
		
		for (var i = 0;i<(pAdd/pRem/2)-2;i++){
			if(particles.length<MAX_PARTICLES){
				var particle = new Particle();
				particle.pos.reset(Math.random()*canvas.width, Math.random()*canvas.height);  
				particle.vel.reset(randomRange(-3,3), randomRange(-3,3)); 
				particles.push(particle);
			}
		}
	}

	if(gen%pAdd*2==0){
		
		for (var i = 0;i<(pAdd/pRem/2)-2;i++){
			if(particles.length<MAX_PARTICLES){
				var particle = new Particle();
				particle.pos.reset(Math.random()*canvas.width, Math.random()*canvas.height);  
				particle.vel.reset(randomRange(-3,3), randomRange(-3,3)); 
				particles.push(particle);
			}
		}
	}	
	
	// no more remove and add
	// #####################
	
	
	
	
	for(var i=0; i<particles.length; i++) { 
		var p1 = particles[i]; 
		
		for(var j=i+1 ; j<particles.length; j++) {
			
			var p2 = particles[j]; 
			
			var dx = p2.pos.x - p1.pos.x; 
			var dy = p2.pos.y - p1.pos.y; 
			
			var distance = Math.sqrt((dx*dx) + (dy*dy)); 
			
			if(distance<jDist - randomRange(0, jDist)) { 
				if(distance>jMDist){
					
					// Lets draw a bezier curbe
					c.beginPath();
					c.moveTo(p1.pos.x, p1.pos.y); 
					var gRng = gen%distance;
					c.lineTo(p2.pos.x, p2.pos.y); 
//					c.bezierCurveTo(p1.pos.x+randomRange(-gRng,gRng), p1.pos.y+randomRange(-gRng,gRng), p2.pos.x+randomRange(-gRng,gRng), p2.pos.y+randomRange(-gRng,gRng), p2.pos.x, p2.pos.y);
//					c.quadraticCurveTo(p1.pos.x+randomRange(-gRng,gRng), p2.pos.y+randomRange(-gRng,gRng), p2.pos.x, p2.pos.y);				
					c.strokeStyle = 'hsla(' + gen + ' , ' + Math.sin(gen) * 100 + '%, 50%, '+ lAl + ')'; 
					c.stroke();
					
				} else {

					// Lets draw a bezier curbe
					c.beginPath();
					c.moveTo(p1.pos.x, p1.pos.y); 
					var gRng = gen%100;
//					c.bezierCurveTo(p1.pos.x+randomRange(-gRng,gRng), p1.pos.y+randomRange(-gRng,gRng), p2.pos.x+randomRange(-gRng,gRng), p2.pos.y+randomRange(-gRng,gRng), p2.pos.x, p2.pos.y);
//					c.quadraticCurveTo(p1.pos.x+randomRange(-gRng,gRng), p2.pos.y+randomRange(-gRng,gRng), p2.pos.x, p2.pos.y);				
					c.lineTo(p2.pos.x, p2.pos.y); 
					c.stroke();

					c.strokeStyle = 'hsla(' + gen + ' , ' + Math.sin(gen) * 100 + '%, 50%, '+ lAl2 + ')'; 
					c.stroke();

				}
			}
		}
	}
		
	
	
	
}



function Particle() {
	
	var pos = this.pos = new Vector2(0,0); 
	var vel = this.vel = new Vector2(0,0); 
	var oldPos = this.oldPos = [];
	
	for (var i; i<10;1++){
		oldPos(i) = new Vector2(0,0);
	}
	
	
	this.update = function(canvas) { 
		
		
		pos.plusEq(vel); 
		
		if(pos.x<0) pos.x = canvas.width; 
		else if(pos.x>canvas.width) pos.x = 0; 
		if(pos.y<0) pos.y = canvas.height; 
		else if(pos.y>canvas.height) pos.y = 0; 	
		
	};
	
	this.draw = function(c) { 
		
		var mSq = 1;
		var mSi = 1;
		var mAl = .1;
		
//		c.strokeStyle = 'hsla(' + gen + ',100%,50%,' + mAl + ')'; 
//		c.beginPath(); 
//		c.fillStyle = 'hsla(' + gen + ',100%,50%,' + mAl + ')';
		//c.fillRect(pos.x, pos.y, 10,10)

//		c.arc(pos.x + randomRange(-mSq,mSq), pos.y + randomRange(-mSq,mSq), mSi + randomRange(-mSi-(mSi/10), mSi), 0, Math.PI*2, true); 
//		c.fill();
//		c.stroke(); 
		
	};
	
	
	
}

function randomRange(min,max){
	return Math.random()*(max-min) + min;
}

</script>
</body>
</html>
